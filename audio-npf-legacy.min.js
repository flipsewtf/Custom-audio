/*
Custom audio for npf and legacy Tumblr posts
-  https://lushwave.tumblr.com
-  https://github.com/flipsewtf/
-  Version 1.0.0
*/
document.addEventListener("DOMContentLoaded",function(){const playSVG=`<svg class='play-audio' xmlns='http://www.w3.org/2000/svg' width='30' height='30' viewBox='0 0 512 512'><g><path fill-rule='evenodd' d='M468.8 235.007 67.441 3.277A24.2 24.2 0 0 0 55.354-.008h-.07A24.247 24.247 0 0 0 43.19 3.279a24 24 0 0 0-12.11 20.992v463.456a24.186 24.186 0 0 0 36.36 20.994L468.8 276.99a24.238 24.238 0 0 0 0-41.983z' fill='currentColor'></path></g></svg>`,pauseSVG=`<svg class='pause-audio' xmlns='http://www.w3.org/2000/svg' width='30' height='30' viewBox='0 0 47.607 47.607'><g><path d='M17.991 40.976a6.631 6.631 0 0 1-13.262 0V6.631a6.631 6.631 0 0 1 13.262 0v34.345zM42.877 40.976a6.631 6.631 0 0 1-13.262 0V6.631a6.631 6.631 0 0 1 13.262 0v34.345z' fill='currentColor'></path></g></svg>`,createCustomPlayer=c=>{const d=document.createElement("div");return d.classList.add("custom-audio-player"),d.innerHTML=`<div class="custom-controls"><button class="play-pause" aria-label="Play audio">${playSVG}</button></div>`,c.appendChild(d),d.querySelector(".play-pause")},handleAudioPosts=()=>{const a=document.querySelectorAll(".tmblr-full");a.forEach(b=>{const c=b.querySelector(".audio-caption"),d=b.querySelector("audio"),e=b.querySelector(".audio_player");if(c&&d&&!d.dataset.handled){d.dataset.handled=!0,d.style.display="none";const f=createCustomPlayer(c);f.addEventListener("click",()=>{d.paused?(d.play(),f.innerHTML=pauseSVG,f.setAttribute("aria-label","Pause audio")):(d.pause(),f.innerHTML=playSVG,f.setAttribute("aria-label","Play audio"))}),d.addEventListener("play",()=>{f.innerHTML=pauseSVG,f.setAttribute("aria-label","Pause audio")}),d.addEventListener("pause",()=>{f.innerHTML=playSVG,f.setAttribute("aria-label","Play audio")})}if(c&&e&&!e.dataset.handled){e.dataset.handled=!0,e.style.display="none";const g=e.querySelector("iframe").src,h=document.createElement("audio");h.src=getAudioSource(g);const f=createCustomPlayer(c);f.addEventListener("click",()=>{h.paused?(h.play(),f.innerHTML=pauseSVG,f.setAttribute("aria-label","Pause audio")):(h.pause(),f.innerHTML=playSVG,f.setAttribute("aria-label","Play audio"))}),h.addEventListener("play",()=>{f.innerHTML=pauseSVG,f.setAttribute("aria-label","Pause audio")}),h.addEventListener("pause",()=>{f.innerHTML=playSVG,f.setAttribute("aria-label","Play audio")}),h.addEventListener("ended",()=>{f.innerHTML=playSVG,f.setAttribute("aria-label","Play audio")})}})},getAudioSource=a=>{let b=decodeURIComponent(a).split("audio_file=")[1].split("&color=")[0];return b.includes(".mp3")||(b=b.split("/").pop(),b="https://a.tumblr.com/"+b+"o1.mp3"),b};handleAudioPosts();const observer=new MutationObserver(()=>{handleAudioPosts()});observer.observe(document.body,{childList:!0,subtree:!0})});
